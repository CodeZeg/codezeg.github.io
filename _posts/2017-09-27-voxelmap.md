---
layout: post
title: 一种高度自定义的游戏场景地图实现
categories: [游戏开发, unity, 思路, 自定义]
description: 这年头不开源个东西不好意思说自己是程序员啊
---

> 创意握在自己手中不如放给玩家

我的世界这款游戏，带来的无穷的幻想，有很多人在里面做了很多很多的场景，玩家的力量其实比策划强多了
所以没错，我就是要抄一抄这个玩意

## 需求分析
1. 格子模型应该有玩家提供
1. 格子应该具有其独特的属性
1. 最好是能够有寻路系统
1. 尽量够大，最好无限大
1. 需要动态的裁剪视野范围外的格子
1. 方便的编辑环境
1. 随机地图

## 技术点分析
1. 存储数据结构
    1. 每个场景应该对应一张格子索引表
    1. 场景有大小限制 1024*1024*64 等
    1. 那么场景大小为 n * 坐标 * id
1. 动态裁剪
    1. 八叉树
    1. 邻近查询
1. 随机地图
    1. Room节点
    1. Hall节点
    1. 每个节点都有自己的接口类型
    1. 使用 hall*n 来连接 room*2 即可

## 伪代码
格子 {
    资源路径 [128bit hash]
    路径类型 [0-255]
    属性包
}

<!-- 编辑地图 {
    {位置, 格子序号} * n
    位置 => 1024*1024*64 = 10bit + 10bit + 6bit = 26bit
    位置 => 4096*4096*64 = 12bit + 12bit + 6bit = 30bit
} -->

运行时地图 {
    八叉树节点 {
        节点层级 [0-32] (1级节点含有8个单元格子, 2级节点含有8个0级节点 以此类推}

        [子节点] * 8
    }  

    根节点
    格子 * n
}

### 搜索算法
假定单元格子的长宽高均为 1
那么n级节点的长宽高均为 2^n
假定根节点的层级为10
那么坐标(x,y,z)的格子只需要从root一直往下迭代即可

